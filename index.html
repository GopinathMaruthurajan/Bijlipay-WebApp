<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Gateway</title>
    <style>
        /* Base Styles */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            margin: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .payment-modes {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .payment-mode {
            flex: 1;
            text-align: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-mode:hover {
            border-color: #4CAF50;
        }

        .payment-mode.selected {
            border-color: #4CAF50;
            background-color: #f0fff0;
        }

        /* Buttons */
        .btn {
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #4CAF50;
        }

        .btn-primary:hover {
            background-color: #45a049;
        }

        .btn-danger {
            background-color: #f44336;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        /* Loading Indicator */
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #4CAF50;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Animations */
        .status-animation {
            display: none;
            text-align: center;
            padding: 40px 0;
        }

        /* Success Animation */
        .checkmark {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: block;
            stroke-width: 5;
            stroke: #4CAF50;
            stroke-miterlimit: 10;
            margin: 0 auto;
            box-shadow: 0 0 0 rgba(76, 175, 80, 0.4);
            animation: checkmark-scale 0.3s ease-in-out 0.9s both;
        }

        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 5;
            stroke-miterlimit: 10;
            stroke: #4CAF50;
            fill: none;
            animation: checkmark-stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark-check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: checkmark-stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        /* Failure Animation */
        .crossmark {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: block;
            stroke-width: 5;
            stroke: #f44336;
            stroke-miterlimit: 10;
            margin: 0 auto;
            box-shadow: 0 0 0 rgba(244, 67, 54, 0.4);
            animation: crossmark-scale 0.3s ease-in-out 0.9s both;
        }

        .crossmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 5;
            stroke-miterlimit: 10;
            stroke: #f44336;
            fill: none;
            animation: crossmark-stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .crossmark-cross {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: crossmark-stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        /* Animation Keyframes */
        @keyframes checkmark-stroke {
            100% { stroke-dashoffset: 0; }
        }

        @keyframes checkmark-scale {
            0%, 100% { transform: none; }
            50% { transform: scale3d(1.1, 1.1, 1); }
        }

        @keyframes crossmark-stroke {
            100% { stroke-dashoffset: 0; }
        }

        @keyframes crossmark-scale {
            0%, 100% { transform: none; }
            50% { transform: scale3d(1.1, 1.1, 1); }
        }

        .status-message {
            font-size: 24px;
            font-weight: bold;
            margin-top: 20px;
            opacity: 0;
            animation: fadeIn 0.3s ease-in-out 1.2s forwards;
        }

        .success-message {
            color: #4CAF50;
        }

        .failed-message {
            color: #f44336;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* Invoice Pages */
        .invoice-page {
            display: none;
        }

        .invoice-header {
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .success-header {
            color: #4CAF50;
        }

        .failed-header {
            color: #f44336;
        }

        .invoice-details {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
        }

        .success-details {
            border: 1px solid #4CAF50;
            background-color: #f9fff9;
        }

        .failed-details {
            border: 1px solid #f44336;
            background-color: #ffebee;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed #ddd;
        }

        .detail-label {
            font-weight: bold;
            color: #555;
        }

        .error-message {
            color: #f44336;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Payment Form -->
    <div class="container" id="paymentForm">
        <h1>Payment Gateway</h1>

        <div class="form-group">
            <label for="billNumber">Customer Bill Number</label>
            <input type="text" id="billNumber" placeholder="Enter bill number">
        </div>

        <label>Payment Mode</label>
        <div class="payment-modes">
            <div class="payment-mode" onclick="selectPaymentMode('card')">
                <img src="https://cdn-icons-png.flaticon.com/512/179/179457.png" width="50" alt="Card">
                <p>Card</p>
            </div>
            <div class="payment-mode" onclick="selectPaymentMode('qr')">
                <img src="https://cdn-icons-png.flaticon.com/512/3916/3916907.png" width="50" alt="Scan QR">
                <p>Scan QR</p>
            </div>
        </div>

        <input type="hidden" id="selectedPaymentMode" value="">

        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p>Processing payment...</p>
        </div>

        <button class="btn btn-primary" onclick="processPayment()">Pay Now</button>
    </div>

    <!-- Success Animation -->
    <div class="container status-animation" id="successAnimation">
        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
            <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
        <div class="status-message success-message">Payment Successful!</div>
    </div>

    <!-- Failure Animation -->
    <div class="container status-animation" id="failedAnimation">
        <svg class="crossmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <circle class="crossmark-circle" cx="26" cy="26" r="25" fill="none"/>
            <path class="crossmark-cross" fill="none" d="M16 16 36 36 M36 16 16 36"/>
        </svg>
        <div class="status-message failed-message">Payment Failed!</div>
    </div>

    <!-- Success Invoice Page -->
    <div class="container invoice-page" id="invoicePage">
        <div class="invoice-header success-header">Payment Receipt</div>
        
        <div class="invoice-details success-details">
            <div class="detail-row">
                <span class="detail-label">Invoice Number:</span>
                <span id="invoiceNumber"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Bill Number:</span>
                <span id="displayBillNumber"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Payment Method:</span>
                <span id="paymentMethod"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Amount:</span>
                <span id="paymentAmount"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Date:</span>
                <span id="paymentDate"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Transaction ID:</span>
                <span id="transactionId"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Terminal ID:</span>
                <span id="terminalId"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Merchant ID:</span>
                <span id="merchantId"></span>
            </div>
            <div class="detail-row" style="border-bottom: none;">
                <span class="detail-label">Status:</span>
                <span style="color: #4CAF50; font-weight: bold;">Completed</span>
            </div>
        </div>

        <button class="btn btn-primary" style="margin-top: 20px;" onclick="resetForm()">New Payment</button>
    </div>

    <!-- Failed Payment Page -->
    <div class="container invoice-page" id="failedPage">
        <div class="invoice-header failed-header">Payment Failed</div>
        
        <div class="invoice-details failed-details">
            <div class="error-message" id="errorMessage"></div>
            
            <div class="detail-row">
                <span class="detail-label">Invoice Number:</span>
                <span id="failedInvoiceNumber"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Bill Number:</span>
                <span id="failedBillNumber"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Payment Method:</span>
                <span id="failedPaymentMethod"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Amount:</span>
                <span id="failedPaymentAmount"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Date:</span>
                <span id="failedPaymentDate"></span>
            </div>
            <div class="detail-row" style="border-bottom: none;">
                <span class="detail-label">Status:</span>
                <span style="color: #f44336; font-weight: bold;">Failed</span>
            </div>
        </div>

        <button class="btn btn-danger" style="margin-top: 20px;" onclick="resetForm()">Try Again</button>
    </div>

    <script>
        // Generate random invoice number
        function generateInvoiceNumber() {
            return 'INV-' + Math.floor(100000 + Math.random() * 900000);
        }

        // Get current date in readable format
        function getCurrentDate() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return now.toLocaleDateString('en-IN', options);
        }

        // Payment mode selection
        function selectPaymentMode(mode) {
            const modes = document.querySelectorAll('.payment-mode');
            modes.forEach(m => m.classList.remove('selected'));

            const selectedMode = document.querySelector(`.payment-mode[onclick="selectPaymentMode('${mode}')"]`);
            selectedMode.classList.add('selected');

            document.getElementById('selectedPaymentMode').value = mode;
        }

        // Process payment using payment:// scheme
        function processPayment() {
            const billNumber = document.getElementById('billNumber').value;
            const paymentMode = document.getElementById('selectedPaymentMode').value;

            if (!billNumber) {
                alert('Please enter bill number');
                return;
            }

            if (!paymentMode) {
                alert('Please select payment mode');
                return;
            }

            // Show loading indicator
            document.getElementById('loadingIndicator').style.display = 'block';

            // Redirect to payment app
            window.location.href = `payment://pay?billNumber=${encodeURIComponent(billNumber)}&amount=1299`;
        }

        // Show success animation then invoice
        function showInvoice(paymentData) {
            // Hide payment form
            document.getElementById('paymentForm').style.display = 'none';
            document.getElementById('loadingIndicator').style.display = 'none';
            
            // Show success animation
            const successAnim = document.getElementById('successAnimation');
            successAnim.style.display = 'block';
            
            // After animation completes, show invoice
            setTimeout(() => {
                successAnim.style.display = 'none';
                document.getElementById('invoicePage').style.display = 'block';
                
                // Format amount with 2 decimal places
                const amount = paymentData.amount ? 
                    parseFloat(paymentData.amount).toLocaleString('en-IN', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    }) : '1,299.00';
                
                // Get payment method display text
                const paymentMethod = paymentData.paymentMethod === 'card' ? 
                    'Credit/Debit Card' : 'QR Code Payment';
                
                // Populate invoice details
                document.getElementById('invoiceNumber').textContent = 
                    paymentData.invoiceNumber || generateInvoiceNumber();
                document.getElementById('displayBillNumber').textContent = 
                    paymentData.billNumber || document.getElementById('billNumber').value;
                document.getElementById('paymentMethod').textContent = paymentMethod;
                document.getElementById('paymentAmount').textContent = '₹' + amount;
                document.getElementById('paymentDate').textContent = getCurrentDate();
                document.getElementById('transactionId').textContent = 
                    paymentData.txnId || 'TXN' + Math.floor(10000000 + Math.random() * 90000000);
                document.getElementById('terminalId').textContent = paymentData.tid || 'N/A';
                document.getElementById('merchantId').textContent = paymentData.mid || 'N/A';
            }, 2000); // Show invoice after 2 seconds
        }

        // Show failed animation then error details
        function showPaymentFailed(errorData) {
            // Hide payment form
            document.getElementById('paymentForm').style.display = 'none';
            document.getElementById('loadingIndicator').style.display = 'none';
            
            // Show failed animation
            const failedAnim = document.getElementById('failedAnimation');
            failedAnim.style.display = 'block';
            
            // After animation completes, show error details
            setTimeout(() => {
                failedAnim.style.display = 'none';
                document.getElementById('failedPage').style.display = 'block';
                
                // Format amount with 2 decimal places
                const amount = errorData.amount ? 
                    parseFloat(errorData.amount).toLocaleString('en-IN', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    }) : '1,299.00';
                
                // Get payment method display text
                const paymentMethod = errorData.paymentMethod === 'card' ? 
                    'Credit/Debit Card' : 'QR Code Payment';
                
                // Populate error details
                document.getElementById('errorMessage').textContent = 
                    errorData.message || 'Payment processing failed';
                document.getElementById('failedInvoiceNumber').textContent = 
                    errorData.invoiceNumber || generateInvoiceNumber();
                document.getElementById('failedBillNumber').textContent = 
                    errorData.billNumber || document.getElementById('billNumber').value;
                document.getElementById('failedPaymentMethod').textContent = paymentMethod;
                document.getElementById('failedPaymentAmount').textContent = '₹' + amount;
                document.getElementById('failedPaymentDate').textContent = getCurrentDate();
            }, 2000); // Show error after 2 seconds
        }

        // Reset form for new payment
        function resetForm() {
            document.getElementById('invoicePage').style.display = 'none';
            document.getElementById('failedPage').style.display = 'none';
            document.getElementById('successAnimation').style.display = 'none';
            document.getElementById('failedAnimation').style.display = 'none';
            document.getElementById('paymentForm').style.display = 'block';
            document.getElementById('billNumber').value = '';
            document.querySelectorAll('.payment-mode').forEach(m => m.classList.remove('selected'));
            document.getElementById('selectedPaymentMode').value = '';
        }

        // Expose functions to Android
        window.showInvoice = showInvoice;
        window.showPaymentFailed = showPaymentFailed;
    </script>
</body>
</html>