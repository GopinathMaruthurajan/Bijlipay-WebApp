<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Gateway</title>
    <style>
        /* (Keep all your existing styles exactly the same) */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        /* ... (all other CSS remains unchanged) ... */
    </style>
</head>
<body>
    <div class="container" id="paymentForm">
        <!-- (Keep all your existing payment form HTML) -->
        <h1>Payment Gateway</h1>
        <div class="invoice-display">
            Invoice Number: <span id="invoiceNumber">INV-</span>
        </div>
        <!-- ... (rest of payment form remains same) ... -->
    </div>

    <div class="container" id="paymentReceipt" style="display: none;">
        <div class="success-message">Payment Successful!</div>
        <div class="invoice-details" id="invoiceDetails">
            <div class="detail-row">
                <span class="detail-label">Invoice Number:</span>
                <span id="receiptInvoice"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Bill Number:</span>
                <span id="receiptBill"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Payment Method:</span>
                <span id="receiptMethod"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Amount:</span>
                <span>â‚¹<span id="receiptAmount">1,299.00</span></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Date:</span>
                <span id="receiptDate"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Transaction ID:</span>
                <span id="receiptTxn"></span>
            </div>
            <!-- NEW TRANSACTION DETAILS ADDED -->
            <div class="detail-row">
                <span class="detail-label">Terminal ID:</span>
                <span id="receiptTid"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Merchant ID:</span>
                <span id="receiptMid"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Transaction Code:</span>
                <span id="receiptTxnCode"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Response Status:</span>
                <span id="receiptResponseStatus"></span>
            </div>
            <div class="detail-row" style="border-bottom: none;">
                <span class="detail-label">Status:</span>
                <span style="color: #4CAF50; font-weight: bold;">Completed</span>
            </div>
        </div>

        <button class="btn" style="margin-top: 20px;" onclick="resetPaymentForm()">New Payment</button>
    </div>

    <script>
        // Generate random invoice number
        function generateInvoiceNumber() {
            const invoiceNumber = 'INV-' + Math.floor(100000 + Math.random() * 900000);
            document.getElementById('invoiceNumber').textContent = invoiceNumber;
            document.getElementById('receiptInvoice').textContent = invoiceNumber;
            return invoiceNumber;
        }

        // Set current date
        function setCurrentDate() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('receiptDate').textContent = now.toLocaleDateString('en-IN', options);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            generateInvoiceNumber();
            setCurrentDate();
        });

        // Payment mode selection
        function selectPaymentMode(mode) {
            const modes = document.querySelectorAll('.payment-mode');
            modes.forEach(m => m.classList.remove('selected'));

            const selectedMode = document.querySelector(`.payment-mode[onclick="selectPaymentMode('${mode}')"]`);
            selectedMode.classList.add('selected');

            document.getElementById('selectedPaymentMode').value = mode;
            document.getElementById('receiptMethod').textContent = mode === 'card' ? 'Credit/Debit Card' : 'QR Code Payment';
        }

        // Initiate payment process
        function initiatePayment() {
            const billNumber = document.getElementById('billNumber').value;
            const paymentMode = document.getElementById('selectedPaymentMode').value;

            if (!billNumber) {
                alert('Please enter bill number');
                return;
            }

            if (!paymentMode) {
                alert('Please select payment mode');
                return;
            }

            // Show loading indicator
            document.getElementById('loadingIndicator').style.display = 'block';

            // Redirect to payment after 5 seconds (simulating processing)
            setTimeout(() => {
                window.location.href = `payment://pay?billNumber=${encodeURIComponent(billNumber)}&amount=1299`;
            }, 5000);
        }

        // Reset payment form
        function resetPaymentForm() {
            document.getElementById('paymentReceipt').style.display = 'none';
            document.getElementById('paymentForm').style.display = 'block';
            document.getElementById('billNumber').value = '';
            document.querySelectorAll('.payment-mode').forEach(m => m.classList.remove('selected'));
            document.getElementById('selectedPaymentMode').value = '';
            generateInvoiceNumber();
            setCurrentDate();
        }

        // Handle payment success with all transaction details
        function onPaymentCompleted(response) {
            try {
                const result = typeof response === 'string' ? JSON.parse(response) : response;
                
                if (result.status === "SUCCESS") {
                    // Show all transaction details
                    showPaymentSuccess({
                        invoiceNumber: result.invoiceNumber || document.getElementById('invoiceNumber').textContent,
                        billNumber: result.intentOrderId || document.getElementById('billNumber').value,
                        amount: 1299.00,
                        paymentMode: document.getElementById('selectedPaymentMode').value,
                        tid: result.tid || '',
                        mid: result.mid || '',
                        txnCode: result.txnCode || '',
                        txnId: result.txnId || '',
                        responseStatus: result.txnResponseStatus || 'Approved'
                    });
                } else {
                    alert("Payment failed: " + (result.message || "Unknown error"));
                    document.getElementById('loadingIndicator').style.display = 'none';
                }
            } catch (e) {
                console.error("Error processing payment response:", e);
                alert("Payment processing error");
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }

        // Show payment success with all details
        function showPaymentSuccess(paymentData) {
            document.getElementById('loadingIndicator').style.display = 'none';
            document.getElementById('paymentForm').style.display = 'none';
            document.getElementById('paymentReceipt').style.display = 'block';
            document.getElementById('invoiceDetails').style.display = 'block';

            // Set receipt details
            document.getElementById('receiptBill').textContent = paymentData.billNumber;
            document.getElementById('receiptTxn').textContent = paymentData.txnId;
            document.getElementById('receiptAmount').textContent = paymentData.amount.toFixed(2);
            
            // Set additional transaction details
            document.getElementById('receiptTid').textContent = paymentData.tid;
            document.getElementById('receiptMid').textContent = paymentData.mid;
            document.getElementById('receiptTxnCode').textContent = paymentData.txnCode;
            document.getElementById('receiptResponseStatus').textContent = paymentData.responseStatus;
        }

        // Expose to Android webview
        window.onPaymentCompleted = onPaymentCompleted;
    </script>
</body>
</html>